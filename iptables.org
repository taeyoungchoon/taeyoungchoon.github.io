* history

- ipfwadm
- ipchains since 2.2
- iptables since 2.4
- nftables since 3.13 (19 January 2014)

* dig

#+BEGIN_SRC lisp

  (table
   (filter (INPUT OUTPUT FORWARD))
   (nat)
   (mangle)
   (raw))

#+END_SRC

* cli

iptables -nL

-n, --numeric
-L, --list

#+BEGIN_EXAMPLE

$ sudo iptables -nL
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

$ sudo iptables -A OUTPUT -p icmp -d 8.8.8.8 -j DROP

$ sudo iptables -nL

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         
DROP       icmp --  0.0.0.0/0            8.8.8.8

$ ping -c 3 8.8.8.8 -W 3
$ sudo iptables -F
$ ping -c 3 8.8.8.8

#+END_EXAMPLE

* iptables vs cisco way, access-list
* TODO log

- [2023-06-27 í™”] log and drop

** duo

  #+begin_src bash
    iptables -I INPUT -p icmp --icmp-type echo-request -j LOG --log-prefix 'iptables drop this : '
    iptables -I INPUT -p icmp --icmp-type echo-request -j DROP

  #+end_src

** uno

  #+begin_src bash
    iptables -N LOG_AND_DROP
    iptables -A LOG_AND_DROP -j LOG --log-prefix 'iptables drop this : '
    iptables -A LOG_AND_DROP -j DROP
  #+end_src

** uno with action

  #+begin_src bash
    iptables -I INPUT -p icmp --icmp-type echo-request -j LOG_AND_DROP
  #+end_src

** word

- netfilter hook
- chain
  - INPUT, OUTPUT, FORWARD
  - user-defined chain(LOG_AND_DROP)
- target
  - terminating target
  - non-terminating target
    - jumping target(LOG_AND_DROP)
      - pass back to calling chain if the end of rule list is reached

